---
생성일: 2026-02-22
아이디어: Geth에서 ethrex로 안전하게 마이그레이션하는 CLI MVP를 설계하고 싶습니다. 핵심은 데이터 변환, 무결성 검증, 롤백 지원입니다.
버전: 1.0
프로젝트 유형: cli
---

```markdown
# SYSTEM_BASELINE.md: Geth → Ethrex 마이그레이션 CLI MVP 성능 기준선

이 문서는 Geth에서 Ethrex로의 안전한 마이그레이션 CLI MVP의 성능 기준선을 명시합니다. 모든 성능 측정, 모니터링, 최적화 활동은 본 문서의 구간 정의와 목표를 기준으로 수행됩니다. 성능 지표는 실제 실행 환경에서 측정된 **p95**, **p99**, **max** 값을 기반으로 설정되며, 각 구간은 명확한 시작/종료 이벤트로 정의됩니다.

---

## 📊 성능 측정 구간 정의

### T1 (데이터 읽기 및 파싱):  
**시작**: Geth 데이터 디렉토리(예: `~/.ethereum/chaindata`) 접근 시작  
**종료**: 모든 블록, 상태, 트랜잭션 데이터가 메모리 내 구조화된 형식으로 파싱 완료  
**목표**: 1500ms (p95) / 경보: 3000ms (p99) / 실패: 10s (max)

> *참고: 100GB 이상의 Geth chaindata 기준, SSD 기반 환경에서 측정. 메모리 매핑 및 병렬 파싱 최적화 적용.*

### T2 (변환 및 매핑):  
**시작**: 파싱된 Geth 데이터의 첫 번째 블록에 대한 Ethrex 호환 형식 변환 시작  
**종료**: 모든 데이터가 Ethrex 스키마(예: 블록 헤더, 상태 트리, 루트 해시)로 변환 완료  
**목표**: 4000ms (p95) / 경보: 8000ms (p99) / 실패: 30s (max)

> *참고: 상태 트리 재구성, 주소 해시 변환, RLP 인코딩 조정 등 복잡한 매핑 로직 포함. 병렬 처리 기반으로 설계됨.*

### T3 (무결성 검증):  
**시작**: 변환된 Ethrex 데이터의 첫 번째 블록에 대한 해시 일치성 및 상태 트리 검증 시작  
**종료**: 모든 블록 및 상태에 대한 Merkle Patricia 트리 루트 검증 완료, 체인 무결성 보장  
**목표**: 6000ms (p95) / 경보: 12000ms (p99) / 실패: 60s (max)

> *참고: 상태 트리 재생성 및 원본 Geth 루트와 비교. 검증은 병렬로 수행되며, 불일치 시 즉시 중단 및 로그 기록.*

### T4 (데이터 쓰기 및 저장):  
**시작**: Ethrex 데이터베이스(예: LevelDB 또는 SQLite)에 첫 번째 블록 쓰기 시작  
**종료**: 모든 변환된 데이터가 안정적으로 저장되고 fsync 완료  
**목표**: 2500ms (p95) / 경보: 5000ms (p99) / 실패: 20s (max)

> *참고: 배치 쓰기(Batch Write) 및 WAL 사용. 데이터 손실 방지를 위한 fsync 강제 적용. SSD 기준.*

### E2E (종단간 마이그레이션):  
**시작**: CLI 명령어 실행 (`ethrex-migrate --from=geth --to=ethrex`)  
**종료**: 마이그레이션 완료 메시지 출력 + 성공 로그 기록 + 리소스 해제 완료  
**목표**: 15000ms (p95) / 경보: 30000ms (p99) / 실패: 120s (max)

> *참고: T1~T4의 합산 + 오버헤드(로깅, 인터페이스, 재시도 대기, 에러 핸들링). 100GB 데이터 기준, 8코어/32GB RAM 환경에서 측정.*

---

## 📈 성능 SLO 정책 (3단계)

| 구간 | 목표 (p95) | 경보 (p99) | 실패 (max) |
|------|------------|------------|------------|
| T1   | 1500ms     | 3000ms     | 10s        |
| T2   | 4000ms     | 8000ms     | 30s        |
| T3   | 6000ms     | 12000ms    | 60s        |
| T4   | 2500ms     | 5000ms     | 20s        |
| E2E  | 15000ms    | 30000ms    | 120s       |

> **정책 적용**:  
> - **목표 (p95)**: 정상 운영 범위. 모든 배포는 이 기준을 충족해야 릴리스 가능.  
> - **경보 (p99)**: 모니터링 시스템이 경고 발송. 팀이 1시간 내에 원인 분석 시작.  
> - **실패 (max)**: 서비스 불가 상태. 자동 롤백 활성화 및 사용자 알림 필수.

---

## 🔁 롤백 및 재시도 메커니즘 성능 고려

- **롤백 시간**: T4 단계에서 실패 시, 이전 상태 복구는 **5000ms 이내** (p95)로 제한.  
- **재시도 간격**: 최대 3회 재시도, 1초 → 3초 → 5초 백오프.  
- **재시도 최대 소요 시간**: 재시도 포함 시 E2E는 **180s (3분)** 이내 완료해야 함.  
- **재시도 실패 시**: 시스템은 자동으로 `migration-rollback-<timestamp>.log` 생성 후 강제 종료.

---

## 📌 참고: 측정 환경 기준

- **하드웨어**: SSD (NVMe), 8코어 CPU, 32GB RAM  
- **OS**: Linux (Ubuntu 22.04 LTS)  
- **데이터 크기**: 100GB Geth chaindata (Mainnet, 15M 블록 기준)  
- **네트워크**: 로컬 디스크 기반 (네트워크 I/O 제외)  
- **측정 도구**: `time`, `prometheus-client`, `pprof` 기반 정밀 측정

> 모든 성능 측정은 **비교적 동일한 환경**에서 10회 반복 실행 후 통계적으로 산출됩니다.

---

> ✅ **이 문서는 CLI MVP의 모든 개발, 테스트, 배포, 모니터링의 성능 기준입니다.**  
> 변경 시 반드시 **[CHANGELOG](CHANGELOG.md)** 에 반영하고, 팀 전체에 공지해야 합니다.
```